# PostgreSQL Configuration for DreamOracle
# Optimized for a VPS with 4GB RAM and moderate traffic

# Connection Settings
max_connections = 100
superuser_reserved_connections = 3

# Memory Settings (adjust based on available RAM)
shared_buffers = 256MB
effective_cache_size = 768MB
work_mem = 4MB
maintenance_work_mem = 64MB
wal_buffers = 8MB

# Query Planner
random_page_cost = 1.1  # SSD optimized
effective_io_concurrency = 200  # SSD optimized
default_statistics_target = 100

# Write-Ahead Log (WAL)
wal_level = replica
max_wal_size = 1GB
min_wal_size = 80MB
checkpoint_completion_target = 0.9

# Background Writer
bgwriter_delay = 200ms
bgwriter_lru_maxpages = 100
bgwriter_lru_multiplier = 2.0

# Logging (useful for debugging slow queries)
log_min_duration_statement = 1000  # Log queries taking more than 1 second
log_checkpoints = on
log_connections = off
log_disconnections = off
log_lock_waits = on
log_statement = 'none'
log_temp_files = 0

# Autovacuum (important for performance)
autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 60s
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_scale_factor = 0.1
autovacuum_analyze_scale_factor = 0.05

# Connection Timeout
statement_timeout = 30000  # 30 seconds
lock_timeout = 10000  # 10 seconds
idle_in_transaction_session_timeout = 60000  # 1 minute

# Timezone
timezone = 'Europe/Paris'
